<!doctype html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0b0b0b" />
    <title>AI Maker Teks To Image — Telegram Mini App</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Monetag: Telegram Mini App in-app interstitial (LOCKED) -->
    <script src='//libtl.com/sdk.js' data-zone='9256839' data-sdk='show_9256839'></script>

  <style>
  /* Root theme variables */
:root {
  --bg: #0b0b0b;
  --elev: #111214;
  --text: #f5f5f5;
  --muted: #b8b8b8;
  --line: #222427;
  --accent: #ffffff;
  --accent-weak: #2a2d31;
  --shadow: 0 8px 24px rgba(0,0,0,.4);
  --radius: 16px;
  --radius-lg: 20px;
  --gap: 16px;
  --gap-lg: 24px;
  --gap-xl: 32px;
  --focus: 0 0 0 2px rgba(255,255,255,.3);
}

html[data-theme="light"] {
  --bg: #fafafa;
  --elev: #ffffff;
  --text: #111111;
  --muted: #5a5f69;
  --line: #e6e7ea;
  --accent: #0f0f0f;
  --accent-weak: #f1f3f5;
  --shadow: 0 12px 28px rgba(0,0,0,.08);
  --focus: 0 0 0 2px rgba(0,0,0,.2);
}

/* Global layout */
* { box-sizing: border-box; }
html, body { height: 100%; }

body { display:flex; flex-direction:column; background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; -webkit-font-smoothing: antialiased; line-height: 1.45; }

.shell { width: 100%; max-width: 640px; margin-inline: auto; padding-inline: 16px; }

h1.title { font-size: 32px; line-height: 1.2; margin: 0; font-weight: 700; }
.h2 { font-size: 24px; margin: 0 0 8px 0; font-weight: 600; }
.h3 { font-size: 20px; margin: 0; font-weight: 600; }
p, li, label, input, select, textarea, button { font-size: 16px; }

.muted { color: var(--muted); }
.sr-only { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; border: 0; clip: rect(0 0 0 0); overflow: hidden; }

/* Header */
[data-sticky="header"] {
  position: sticky; top: 0; z-index: 50;
  background: color-mix(in hsl, var(--bg) 90%, transparent);
  backdrop-filter: saturate(1.2) blur(8px);
  display: grid; grid-template-columns: 44px 1fr 44px;
  align-items: center; gap: 8px; height: 64px;
  border-bottom: 1px solid var(--line);
}

.title-wrap { display: flex; align-items: center; justify-content: center; }
.icon-btn {
  height: 44px; width: 44px; border-radius: 12px; border: 1px solid var(--line);
  background: var(--elev); color: var(--text);
  display: inline-grid; place-items: center;
  transition: background .2s ease, transform .2s ease, border-color .2s ease;
}
.icon-btn:active { transform: scale(.98); }
.icon-btn:focus-visible { outline: none; box-shadow: var(--focus); }
.theme-icon { display: none; }
html[data-theme="light"] #icon-sun { display: none; }
html[data-theme="light"] #icon-moon { display: inline; }
html[data-theme="dark"] #icon-sun { display: inline; }
html[data-theme="dark"] #icon-moon { display: none; }

/* LoadingBar */
.loadingbar {
  display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
  padding: 10px 16px; border-bottom: 1px dashed var(--line);
}
.loadingbar .bar { height: 6px; background: var(--accent-weak); border-radius: 999px; overflow: hidden; }
.loadingbar .progress { height: 100%; width: 0%; background: var(--accent); border-radius: 999px; transition: width .25s ease; }
.loadingbar .label { font-size: 12px; color: var(--muted); }

/* Cards */
.card {
  background: var(--elev); border: 1px solid var(--line);
  border-radius: var(--radius-lg); padding: 16px; margin-top: 16px;
  box-shadow: var(--shadow);
}
.card.hero { padding: 20px; }
.card.preview { padding: 12px; }

/* Form rows */
.row { display: grid; gap: 8px; margin-top: 12px; }
.row.spaced { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

input, select, textarea {
  width: 100%; padding: 12px 14px; border-radius: 12px;
  border: 1px solid var(--line); background: transparent; color: var(--text);
  transition: border-color .2s ease, background .2s ease;
}
textarea { resize: vertical; min-height: 120px; }
input:focus, select:focus, textarea:focus { outline: none; box-shadow: var(--focus); }

.helper { margin-top: 10px; }

/* Toolbar */
.toolbar { display: grid; grid-auto-flow: column; grid-auto-columns: 1fr; gap: 10px; overflow-x: auto; padding: 8px 0; margin-top: 8px; }
.btn {
  height: 44px; border-radius: 12px; padding: 0 14px; font-weight: 500;
  display: inline-flex; align-items: center; gap: 10px; justify-content: center;
  border: 1px solid var(--line); color: var(--text); background: var(--elev);
  transition: transform .2s ease, background .2s ease, border-color .2s ease;
}
.btn:hover { border-color: color-mix(in hsl, var(--accent) 40%, var(--line)); }
.btn:active { transform: translateY(1px) scale(.99); }
.btn:disabled { opacity: .5; pointer-events: none; }
.btn.primary { background: var(--accent); color: var(--bg); border-color: var(--accent); }
.btn.ghost { background: transparent; }
.btn.outline { background: transparent; border-style: dashed; }
.btn.unlock { background: linear-gradient(180deg, #fff, #dcdcdc); color: #111; border-color: #fff; }
html[data-theme="dark"] .btn.unlock { background: linear-gradient(180deg, #1a1a1a, #0f0f0f); color: #fafafa; border-color: #2a2a2a; }
.btn.fullwidth { width: 100%; height: 48px; margin-top: 12px; }

/* Preview */
.preview-wrap { width: 100%; aspect-ratio: 1 / 1; border-radius: 16px; overflow: hidden; background: #0d0f12; border: 1px dashed var(--line); display: grid; place-items: center; }
.preview-empty { display: grid; gap: 8px; place-items: center; text-align: center; color: var(--muted); }
.preview img, #previewImg { width: 100%; height: 100%; object-fit: cover; display: none; }

/* Bottom Sheet */
.sheet { position: fixed; inset: 0; display: none; z-index: 60; }
.sheet[aria-hidden="false"] { display: block; }
.sheet-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.45); backdrop-filter: blur(8px); }
.sheet-panel {
  position: absolute; left: 0; right: 0; bottom: 0;
  margin: 0 auto; width: 100%; max-width: 640px; max-height: 70vh;
  background: var(--elev); border-top-left-radius: 20px; border-top-right-radius: 20px;
  border: 1px solid var(--line); display: grid; grid-template-rows: auto 1fr auto;
  transform: translateY(8px); animation: sheetUp .25s ease forwards;
}
@keyframes sheetUp { to { transform: translateY(0); } }
.sheet-header, .sheet-footer { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--line); }
.sheet-footer { border-top: 1px solid var(--line); border-bottom: none; }
.sheet-content { padding: 12px 16px; overflow: auto; }
.divider { height: 1px; background: var(--line); margin: 12px 0; }

/* Modal */
.modal { position: fixed; inset: 0; display: none; z-index: 70; }
.modal[aria-hidden="false"] { display: grid; place-items: center; }
.modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.5); backdrop-filter: blur(8px); }
.modal-panel {
  position: relative; width: min(560px, 92vw); background: var(--elev); border: 1px solid var(--line);
  border-radius: 20px; box-shadow: var(--shadow); padding: 0; display: grid; grid-template-rows: auto 1fr;
  animation: fadeIn .2s ease both;
}
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid var(--line); }
.modal-content { padding: 16px; color: var(--text); }
.menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; }
.menu-item { border-radius: 14px; border: 1px solid var(--line); background: var(--elev); color: var(--text); padding: 12px; text-align: left; box-shadow: var(--shadow); }
.menu-item small { display: block; color: var(--muted); margin-top: 4px; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

/* Footer */
[data-sticky="footer"] {
  position: sticky; bottom: 0; z-index: 40; background: color-mix(in hsl, var(--bg) 94%, transparent);
  backdrop-filter: saturate(1.2) blur(8px); border-top: 1px solid var(--line);
  display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; height: 64px; padding-block: 6px;
}
.foot-btn { background: transparent; border: none; color: var(--text); display: grid; place-items: center; gap: 4px; font-size: 12px; }
.foot-btn svg { opacity: .9; }

/* Toast */
.toast {
  position: fixed; left: 50%; bottom: 100px; transform: translateX(-50%) translateY(12px);
  background: var(--elev); color: var(--text); padding: 12px 16px; border-radius: 12px; border: 1px solid var(--line);
  box-shadow: var(--shadow); min-width: 240px; max-width: 90vw; text-align: center; opacity: 0; pointer-events: none; transition: opacity .2s ease, transform .2s ease;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
.toast.success { border-color: #31c48d; }
.toast.error { border-color: #ef4444; }
.toast.info { border-color: #60a5fa; }

/* Responsive */
@media (max-width:420px) {
  .row.spaced { grid-template-columns: 1fr; }
  h1.title { font-size: 24px; }
}
  </style>
  </head>
  <body>
    <header data-sticky="header" class="shell">
      <button id="btn-menu" class="icon-btn" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <rect x="3" y="5" width="18" height="2" rx="1" />
          <rect x="3" y="11" width="18" height="2" rx="1" />
          <rect x="3" y="17" width="18" height="2" rx="1" />
        </svg>
      </button>
      <div class="title-wrap">
        <h1 class="title">AI Maker Teks To Image</h1>
      </div>
      <button id="btn-theme" class="icon-btn" aria-label="Ganti tema">
        <svg id="icon-sun" class="theme-icon sun" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4a1 1 0 0 1 1 1v1.25a1 1 0 1 1-2 0V5a1 1 0 0 1 1-1Zm0 12.5a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9ZM4 11a1 1 0 1 1 0 2H2.75a1 1 0 1 1 0-2H4Zm18 0a1 1 0 1 1 0 2H19.75a1 1 0 1 1 0-2H22ZM5.964 6.671a1 1 0 0 1 1.414-1.414l.885.885a1 1 0 1 1-1.414 1.414l-.885-.885Zm10.773 10.773a1 1 0 0 1 1.414-1.414l.885.885a1 1 0 1 1-1.414 1.414l-.885-.885ZM6.849 17.444a1 1 0 0 1 1.414 1.414l-.885.885a1 1 0 1 1-1.414-1.414l.885-.885Zm10.773-10.773a1 1 0 0 1 1.414 1.414l-.885.885a1 1 0 1 1-1.414-1.414l.885-.885Z"/></svg>
        <svg id="icon-moon" class="theme-icon moon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/></svg>
      </button>
    </header>

    <div id="loadingbar" class="loadingbar shell" aria-live="polite" aria-busy="false">
      <div class="bar">
        <div class="progress"></div>
      </div>
      <div class="label">Siap</div>
    </div>

    <main id="app" class="shell">
      <section class="card hero">
        <h2 class="h2">Ubah Teks jadi Gambar AI</h2>
        <p class="muted">Ketik deskripsi, pilih gaya, lalu “Buat”. Gunakan “Unduh” untuk menyimpan. Fitur utama akan aktif setelah Anda menonton iklan singkat.</p>
      </section>

      <section id="settings" class="card">
        <div class="row">
          <label for="modeSelect">Mode</label>
          <select id="modeSelect">
            <option value="ai">AI (Online, Kualitas Tinggi)</option>
            <option value="local">Lokal (Cepat, Tanpa Internet)</option>
          </select>
        </div>
        <div class="row">
          <label for="styleSelect">Gaya</label>
          <select id="styleSelect"></select>
        </div>
        <div class="row">
          <label for="sizeSelect">Ukuran</label>
          <select id="sizeSelect">
            <option value="512x512">Persegi (512×512)</option>
            <option value="768x512">Landscape (768×512)</option>
            <option value="512x768">Portrait (512×768)</option>
          </select>
        </div>
        <div class="row">
          <label for="seedInput">Seed</label>
          <input id="seedInput" type="number" min="0" max="999999" placeholder="acak" />
        </div>
      </section>

      <section id="composer" class="card">
        <label for="promptInput" class="sr-only">Deskripsi Gambar</label>
        <textarea id="promptInput" rows="5" placeholder="Contoh: kucing astronot bergaya sinematik, detail tinggi, dramatis, volumetric lighting"></textarea>
        <div class="helper muted">Gunakan bahasa alami. Tambahkan detail: suasana, pencahayaan, lensa, warna.</div>
      </section>

      <nav id="toolbar" class="toolbar">
        <button id="btn-new" class="btn ghost" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Baru
        </button>
        <button id="btn-import" class="btn ghost" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v12m0 0l-4-4m4 4l4-4M4 21h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Impor
        </button>
        <button id="btn-generate" class="btn primary" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.92L18.18 22 12 18.77 5.82 22 7 14.19l-5-4.92 6.91-1.01L12 2z"/></svg>
          Buat
        </button>
        <button id="btn-download" class="btn ghost" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v12m0 0l-4-4m4 4l4-4M4 21h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          Unduh
        </button>
      </nav>

      <button id="btn-unlock" class="btn unlock fullwidth">
        🔓 Buka Fitur (Tonton Iklan)
      </button>

      <section id="previewCard" class="card preview">
        <div class="preview-wrap">
          <img id="previewImg" alt="Pratinjau gambar hasil AI" />
          <div id="previewEmpty" class="preview-empty">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14l4-4h12a2 2 0 0 0 2-2Z"/></svg>
            <p class="muted">Belum ada gambar. Tulis deskripsi lalu ketuk “Buat”.</p>
          </div>
        </div>
        <div class="row spaced">
          <button id="btn-regenerate" class="btn outline" disabled>Ulangi</button>
          <button id="btn-copyurl" class="btn outline" disabled>Salin URL</button>
        </div>
      </section>
    </main>

    <!-- Bottom Sheet: Import -->
    <div id="sheet-import" class="sheet" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="sheet-backdrop" data-close="sheet-import"></div>
      <div class="sheet-panel" role="document" tabindex="-1">
        <header class="sheet-header">
          <h3 class="h3">Impor Deskripsi</h3>
          <button class="icon-btn" data-close="sheet-import" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="sheet-content">
          <div class="row">
            <label for="fileInput">Impor dari file (.txt)</label>
            <input id="fileInput" type="file" accept=".txt,text/plain" />
          </div>
          <div class="divider"></div>
          <div class="row">
            <label for="importText">Atau tempel teks</label>
            <textarea id="importText" rows="6" placeholder="Tempel deskripsi di sini..."></textarea>
          </div>
        </div>
        <footer class="sheet-footer">
          <button class="btn ghost" data-close="sheet-import">Batal</button>
          <button id="btn-import-apply" class="btn primary">Terapkan</button>
        </footer>
      </div>
    </div>

    <!-- Modal: Menu (sinkron footer) -->
    <div id="modal-menu" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="modal-backdrop" data-close="modal-menu"></div>
      <div class="modal-panel" role="document" tabindex="-1">
        <header class="modal-header">
          <h3 class="h3">Menu</h3>
          <button class="icon-btn" data-close="modal-menu" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="menu-grid">
          <button class="menu-item" data-open="modal-bantuan">
            <span>🆘 Bantuan</span>
            <small>FAQ & dukungan</small>
          </button>
          <button class="menu-item" data-open="modal-panduan">
            <span>📘 Panduan</span>
            <small>Tips membuat prompt</small>
          </button>
          <button class="menu-item" data-open="modal-ketentuan">
            <span>📄 Ketentuan</span>
            <small>Penggunaan & lisensi</small>
          </button>
          <button class="menu-item" data-open="modal-tentang">
            <span>ℹ️ Tentang</span>
            <small>Versi & kredensial</small>
          </button>
        </div>
      </div>
    </div>

    <!-- Modals: Footer -->
    <div id="modal-bantuan" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="modal-backdrop" data-close="modal-bantuan"></div>
      <div class="modal-panel" role="document" tabindex="-1">
        <header class="modal-header">
          <h3 class="h3">Bantuan</h3>
          <button class="icon-btn" data-close="modal-bantuan" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="modal-content">
          <p>1) Ketik deskripsi sejelas mungkin. 2) Pilih gaya & ukuran. 3) Ketuk “Buat”. 4) Simpan lewat “Unduh”.</p>
          <p>Jika fitur terkunci, ketuk “Buka Fitur (Tonton Iklan)”.</p>
        </div>
      </div>
    </div>

    <div id="modal-panduan" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="modal-backdrop" data-close="modal-panduan"></div>
      <div class="modal-panel" role="document" tabindex="-1">
        <header class="modal-header">
          <h3 class="h3">Panduan Prompt</h3>
          <button class="icon-btn" data-close="modal-panduan" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="modal-content">
          <ul>
            <li>Sebut subjek, gaya, mood, pencahayaan, warna.</li>
            <li>Contoh: “potret rubah bergaya sinematik, bokeh, 85mm, rim light, warna hangat”.</li>
            <li>Gunakan Inggris untuk cakupan gaya yang lebih luas.</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="modal-ketentuan" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="modal-backdrop" data-close="modal-ketentuan"></div>
      <div class="modal-panel" role="document" tabindex="-1">
        <header class="modal-header">
          <h3 class="h3">Ketentuan Penggunaan</h3>
          <button class="icon-btn" data-close="modal-ketentuan" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="modal-content">
          <p>Gambar dihasilkan oleh AI pihak ketiga. Hindari konten sensitif/melanggar hukum. Penggunaan sesuai kebijakan masing-masing penyedia.</p>
        </div>
      </div>
    </div>

    <div id="modal-tentang" class="modal" aria-hidden="true" aria-modal="true" role="dialog">
      <div class="modal-backdrop" data-close="modal-tentang"></div>
      <div class="modal-panel" role="document" tabindex="-1">
        <header class="modal-header">
          <h3 class="h3">Tentang</h3>
          <button class="icon-btn" data-close="modal-tentang" aria-label="Tutup">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </header>
        <div class="modal-content">
          <p>AI Maker Teks To Image — Mini App Telegram. Penyedia AI: Pollinations (gratis) + fallback lokal (canvas).</p>
          <p>Privasi: tidak ada data disimpan di server kami.</p>
        </div>
      </div>
    </div>

    <!-- Toasts -->
    <div id="toast" class="toast" aria-live="polite"></div>

    <!-- Footer -->
    <footer data-sticky="footer" class="shell">
      <button class="foot-btn" data-open="modal-bantuan">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 15h-2v-2h2Zm2.07-7.75-.9.92A3.5 3.5 0 0 0 12.5 13h-1v-1a2 2 0 0 1 .55-1.38l1.2-1.2A1.5 1.5 0 1 0 10.5 7H9a3 3 0 1 1 6 0 2.99 2.99 0 0 1-.93 2.25Z"/></svg>
        <span>Bantuan</span>
      </button>
      <button class="foot-btn" data-open="modal-panduan">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M4 5a2 2 0 0 1 2-2h11a1 1 0 0 1 1 1v15.5a.5.5 0 0 1-.757.429L15 18.5l-2.243 1.429a.5.5 0 0 1-.514 0L10 18.5l-2.243 1.429A.5.5 0 0 1 7 19.5V4a1 1 0 0 0-1-1H6a2 2 0 0 0-2 2v13"/></svg>
        <span>Panduan</span>
      </button>
      <button class="foot-btn" data-open="modal-ketentuan">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M6 2h9a3 3 0 0 1 3 3v13l-4-2-4 2-4-2-4 2V5a3 3 0 0 1 3-3Z"/></svg>
        <span>Ketentuan</span>
      </button>
      <button class="foot-btn" data-open="modal-tentang">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
        <span>Tentang</span>
      </button>
    </footer>

<script>
/* AI Maker Teks To Image — Telegram Mini App SPA
   Contract compliance:
   - PROVIDER_CHOICES
   - loadProviderClient( ... )
   - withMonetagInApp( ... ), monetagReady, adQueue, AD_TIMEOUT_MS, show_9256839(
   - downloadBlob( ... ) with URL.createObjectURL( navigator.share( window.open(
   - onGenerateClick( onDownloadClick( onSupportClick(
   - window.Telegram?.WebApp?.expand(
   - Toast messages Bahasa Indonesia incl. "Tap & tahan gambar"
*/

/* ---------- Title parsing and init ---------- */
function parseTitle(title) {
  const raw = Array.isArray(title) ? title.join(" ") : String(title || "");
  // Simple heuristic
  const involvesAI = /(^|\s)ai($|\s)/i.test(raw) || /teks.*gambar|text.*image/i.test(raw);
  return {
    title: raw.trim() || "AI Maker Teks To Image",
    capability: involvesAI ? "ai.text_to_image" : "utility",
    primaryCta: "Buat",
    inputs: ["prompt"],
    ui: {
      sizeOptions: ["512x512", "768x512", "512x768"],
      styles: [
        { id: "photo", label: "Realistis (Foto)", prefix: "ultra realistic photo, 35mm, shallow depth of field, film grain, natural lighting, detailed" },
        { id: "cinematic", label: "Sinematik", prefix: "cinematic lighting, volumetric light, dramatic shadows, high detail, 4k, hyperreal" },
        { id: "illustration", label: "Ilustrasi", prefix: "digital illustration, clean lines, sharp vector, flat shading, Behance trending" },
        { id: "anime", label: "Anime", prefix: "anime style, vibrant colors, studio quality, detailed line art, masterpiece, best quality" },
        { id: "minimal", label: "Minimalis", prefix: "minimalist, monochrome, simple shapes, high contrast, balanced composition" }
      ]
    },
    involvesAI
  };
}

/* ---------- Providers & Discovery ---------- */
const PROVIDER_CHOICES = [
  {
    id: "local-canvas",
    name: "Canvas Lokal",
    kind: "local",
    clientUrl: "local://canvas",
    requiresAuth: false,
    reason: "Selalu tersedia, menghasilkan poster typografi dari teks.",
    score: 0.65
  },
  {
    id: "pollinations",
    name: "Pollinations.ai",
    kind: "remote",
    clientUrl: "https://image.pollinations.ai",
    requiresAuth: false,
    reason: "Gratis & tanpa kunci API, cocok untuk teks-ke-gambar.",
    score: 0.92
  }
];

async function discoverProviders(spec = { timeout: 3000 }) {
  const results = [];
  for (const p of PROVIDER_CHOICES) {
    if (p.kind === "local") {
      results.push({ ...p, reachable: true, latency: 0 });
      continue;
    }
    const url = p.clientUrl.includes("pollinations")
      ? `${p.clientUrl}/prompt/ok?width=8&height=8&seed=1&nologo=true&nocache=${Date.now()}`
      : p.clientUrl;

    try {
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), spec.timeout || 3000);
      const resp = await fetch(url, { mode: "no-cors", cache: "no-store", signal: controller.signal });
      clearTimeout(t);
      // no-cors returns opaque with status 0; treat resolve as reachable
      results.push({ ...p, reachable: true, latency: 0 });
    } catch (e) {
      results.push({ ...p, reachable: false, error: String(e) });
    }
  }
  return results;
}

async function loadProviderClient(providerId) {
  // Placeholder to match contract; loading happens inline for remote fetch.
  // Could dynamically import WASM/CDN if needed.
  if (providerId === "pollinations") {
    return { id: "pollinations" };
  }
  if (providerId === "local-canvas") {
    return { id: "local-canvas" };
  }
  throw new Error("Provider tidak dikenal: " + providerId);
}

function buildPipeline(capabilityKey) {
  const runLocal = async (input, settings, onProgress) => {
    onProgress?.("Menyiapkan kanvas lokal…", 10);
    const [w, h] = (settings.size || "512x512").split("x").map(Number);
    const seed = Number.isFinite(settings.seed) ? settings.seed : Math.floor(Math.random() * 999999);
    const style = settings.style || "photo";
    const styleLabel = settings.styleLabel || "Minimalis";

    // Canvas render
    const cnv = document.createElement("canvas");
    cnv.width = w; cnv.height = h;
    const ctx = cnv.getContext("2d");

    // Background gradient
    const rng = mulberry32(seed);
    const hue = Math.floor(rng() * 360);
    const grad = ctx.createLinearGradient(0, 0, w, h);
    const bg1 = `hsl(${hue}, 12%, 14%)`;
    const bg2 = `hsl(${(hue+30)%360}, 10%, 8%)`;
    grad.addColorStop(0, bg1);
    grad.addColorStop(1, bg2);
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, w, h);

    // Decorative shapes (based on style)
    onProgress?.("Menggambar latar…", 30);
    const shapes = style === "anime" ? 24 : style === "illustration" ? 18 : 12;
    for (let i=0;i<shapes;i++){
      ctx.globalAlpha = 0.035 + rng()*0.05;
      const x = rng() * w, y = rng() * h;
      const r = 20 + rng()* (Math.min(w,h)/6);
      const ang = rng()*Math.PI*2;
      ctx.fillStyle = `hsl(${(hue + i*7)%360}, 40%, ${style==="minimal"? 80: 55}%)`;
      ctx.beginPath();
      if (style === "minimal") {
        ctx.roundRect(x, y, r, r, 8);
      } else {
        ctx.arc(x, y, r, 0, Math.PI*2);
      }
      ctx.fill();
    }

    // Title text (input prompt)
    onProgress?.("Menulis teks…", 55);
    const text = (input || "").trim() || "Deskripsi kosong";
    const padding = 28;
    const maxWidth = w - padding*2;

    // Headline font size autoscale
    let size = Math.min(Math.max(Math.floor(w/16), 18), 48);
    ctx.font = `${style==="minimal"?"600": "700"} ${size}px Inter, system-ui, sans-serif`;
    ctx.fillStyle = style === "photo" ? "#f5f5f5" : "#ffffff";
    ctx.textBaseline = "top";
    ctx.shadowColor = "rgba(0,0,0,0.35)";
    ctx.shadowBlur = 10;
    const lines = wrapText(ctx, text, maxWidth);

    // Center vertically
    const lineHeight = size * 1.3;
    const totalHeight = lines.length * lineHeight;
    let y = (h - totalHeight)/2;
    const x = padding;

    for (const ln of lines) {
      ctx.fillText(ln, x, y);
      y += lineHeight;
    }

    // Corner meta
    ctx.shadowBlur = 0;
    ctx.globalAlpha = .9;
    ctx.fillStyle = "rgba(255,255,255,.85)";
    ctx.font = `500 12px Inter, system-ui`;
    const meta = `Canvas Lokal • ${styleLabel} • #${seed}`;
    const tw = ctx.measureText(meta).width;
    ctx.fillRect(w - tw - 20 - 8, h - 28 - 8, tw + 16, 28);
    ctx.fillStyle = "#0f0f0f";
    ctx.fillText(meta, w - tw - 20, h - 26);

    onProgress?.("Menyelesaikan…", 85);
    const blob = await new Promise(res => cnv.toBlob(res, "image/png", 0.95));
    const objectUrl = URL.createObjectURL(blob); // URL.createObjectURL(
    onProgress?.("Berhasil (lokal)", 100);
    return { blob, objectUrl, providerId: "local-canvas" };
  };

  const runPollinations = async (input, settings, onProgress) => {
    const stylePrefix = settings.stylePrefix || "";
    const negative = "low quality, blurry, noisy, distorted, watermark, text, logo";
    const composed = `${stylePrefix}, ${input}`.trim();
    const [w, h] = (settings.size || "512x512").split("x").map(Number);
    const seed = Number.isFinite(settings.seed) ? settings.seed : Math.floor(Math.random() * 999999);

    const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(composed)}?width=${w}&height=${h}&nologo=true&seed=${seed}&negative=${encodeURIComponent(negative)}&nocache=${Date.now()}`;

    onProgress?.("Meminta model AI…", 5);
    // Simulated incremental progress while fetching
    let p = 5;
    const t = setInterval(() => {
      p = Math.min(95, p + Math.random()*7);
      onProgress?.("Menghasilkan gambar…", Math.floor(p));
    }, 350);

    const resp = await fetch(url, { mode: "cors", cache: "no-store" });
    clearInterval(t);
    if (!resp.ok) throw new Error(`Gagal memuat gambar, status ${resp.status}`);

    onProgress?.("Mengunduh hasil…", 96);
    const blob = await resp.blob();
    const objectUrl = URL.createObjectURL(blob); // URL.createObjectURL(
    onProgress?.("Selesai", 100);
    return { blob, objectUrl, providerId: "pollinations", sourceUrl: url };
  };

  return {
    async run(input, settings, onProgress) {
      // Order preference: if user chooses mode, respect it. Otherwise follow local -> remote sequence.
      const mode = settings.mode || "ai";
      const reachable = (window.AppState?.providersReachable || []).filter(p => p.reachable);
      const hasPoll = reachable.find(p => p.id === "pollinations");
      const tryStack = mode === "local"
        ? ["local-canvas", hasPoll && "pollinations"].filter(Boolean)
        : [hasPoll && "pollinations", "local-canvas"].filter(Boolean);

      let lastErr;
      for (const pid of tryStack) {
        try {
          await loadProviderClient(pid);
          if (pid === "local-canvas") {
            return await runLocal(input, settings, onProgress);
          } else if (pid === "pollinations") {
            return await runPollinations(input, settings, onProgress);
          }
        } catch (e) {
          lastErr = e;
          showToast(`Gagal di penyedia ${pid}. Mencoba cadangan…`, "info");
          continue;
        }
      }
      throw lastErr || new Error("Tidak ada provider tersedia.");
    }
  };
}

/* ---------- Mini helpers ---------- */
function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
function wrapText(ctx, text, maxWidth) {
  const words = text.split(/\s+/);
  const lines = [];
  let line = "";
  for (let n=0; n<words.length; n++) {
    const testLine = line ? line + " " + words[n] : words[n];
    const metrics = ctx.measureText(testLine);
    if (metrics.width > maxWidth && n > 0) {
      lines.push(line);
      line = words[n];
    } else {
      line = testLine;
    }
  }
  if (line) lines.push(line);
  return lines.slice(0, 10); // prevent overflow
}

/* ---------- UI: Loading bar ---------- */
class LoadingBar {
  constructor(root) {
    this.root = root;
    this.progressEl = root.querySelector(".progress");
    this.labelEl = root.querySelector(".label");
    this.timer = null;
  }
  start(label="Memulai…") {
    this.setLabel(label);
    this.root.setAttribute("aria-busy", "true");
    this.set(5);
  }
  tick(delta=3) {
    const cur = this.value || 0;
    this.set(Math.min(cur + delta, 95));
  }
  setLabel(text) {
    if (this.labelEl) this.labelEl.textContent = text;
  }
  set(v) {
    this.value = v;
    this.progressEl.style.width = `${v}%`;
  }
  finish(label="Selesai") {
    this.set(100);
    this.setLabel(label);
    setTimeout(() => { this.root.setAttribute("aria-busy","false"); this.set(0); this.setLabel("Siap"); }, 350);
  }
  fail(reason="Gagal") {
    this.setLabel(reason);
    this.root.setAttribute("aria-busy","false");
    this.set(0);
  }
}

/* ---------- Toast ---------- */
let toastTimer;
function showToast(msg, type="info", timeout=2600) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.className = `toast show ${type}`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ t.className = "toast"; }, timeout);
}

/* ---------- Monetag In-App Ad ---------- */
const AD_TIMEOUT_MS = 15000;
let adQueue = [];
let monetagReady = new Promise(resolve => {
  const start = Date.now();
  (function check(){
    if (typeof window.show_9256839 === "function") { // show_9256839(
      resolve(true);
    } else if (Date.now() - start > AD_TIMEOUT_MS) {
      resolve(false);
    } else {
      setTimeout(check, 200);
    }
  })();
});

async function withMonetagInApp(label, onUnlocked) { // withMonetagInApp(
  try {
    const ready = await monetagReady;
    if (!ready) {
      showToast("Gagal memuat iklan, coba lagi.", "error");
      return;
    }
    // Put into queue to avoid rapid fire
    await new Promise(res => setTimeout(res, 100));
    const done = new Promise((resolve) => {
      // Try to call ad function; SDK should handle display & redirect
      try {
        const ret = window.show_9256839?.(); // show_9256839(
        // We can't detect close reliably; use timeout fallback
      } catch (e) {
        // Ignore
      }
      // Assume user closes ad in a few seconds
      setTimeout(resolve, 3000);
    });
    await withTimeout(done, AD_TIMEOUT_MS);
    onUnlocked?.();
  } catch (e) {
    showToast("Gagal memuat iklan, coba lagi.", "error");
  }
}
async function withTimeout(promise, ms) {
  let t;
  const timeout = new Promise((_, rej) => t = setTimeout(() => rej(new Error("timeout")), ms));
  try { return await Promise.race([promise, timeout]); }
  finally { clearTimeout(t); }
}

/* ---------- Download util (TMA-safe) ---------- */
async function downloadBlob(blob, filename, mime="image/png") { // downloadBlob(
  try {
    const url = URL.createObjectURL(blob); // URL.createObjectURL(
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 1500);
    return;
  } catch (e) {
    // continue to next fallback
  }
  try {
    if (navigator.share) { // navigator.share(
      const file = new File([blob], filename, { type: mime });
      await navigator.share({ title: "Bagikan Gambar", files: [file], text: "Gambar dari AI Maker" });
      return;
    }
  } catch (e) {
    // continue
  }
  try {
    // Last resort open in new window (may be blocked in WebApp)
    const tempUrl = URL.createObjectURL(blob); // URL.createObjectURL(
    window.open(tempUrl, "_blank"); // window.open(
    setTimeout(()=> URL.revokeObjectURL(tempUrl), 2000);
  } catch (e) {
    // Show hold-to-save hint for Telegram
    showToast('Tap & tahan gambar untuk menyimpan ke perangkat', 'info', 4000); // Tap & tahan gambar
  }
}

/* ---------- Toolbar lock/unlock ---------- */
function unlockToolbarButtons() {
  ["btn-new","btn-import","btn-generate","btn-download","btn-regenerate","btn-copyurl"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = false;
  });
  showToast("Fitur utama telah dibuka. Silakan lanjutkan.", "success");
}
function lockToolbarButtons() {
  ["btn-new","btn-import","btn-generate","btn-download","btn-regenerate","btn-copyurl"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = true;
  });
}

/* ---------- App State ---------- */
window.AppState = {
  parsed: null,
  providersReachable: [],
  loadingBar: null,
  currentBlob: null,
  currentUrl: null,
  lastSourceUrl: null
};

/* ---------- Core actions ---------- */
async function onUnlockClick(e) {
  const btn = e.currentTarget;
  btn.disabled = true;
  await withMonetagInApp("Buka Fitur", () => unlockToolbarButtons());
  setTimeout(() => btn.disabled = false, 1000);
}

async function onGenerateClick(e) { // onGenerateClick(
  const lb = AppState.loadingBar;
  const prompt = document.getElementById("promptInput").value.trim();
  const mode = document.getElementById("modeSelect").value;
  const styleSel = document.getElementById("styleSelect");
  const style = styleSel.value;
  const styleLabel = styleSel.selectedOptions[0]?.textContent || "Gaya";
  const stylePrefix = styleSel.selectedOptions[0]?.dataset.prefix || "";
  const size = document.getElementById("sizeSelect").value;
  const seedVal = document.getElementById("seedInput").value;
  const seed = seedVal ? parseInt(seedVal, 10) : undefined;

  if (!prompt) {
    showToast("Isi deskripsi terlebih dahulu.", "info"); return;
  }

  lb.start("Menyiapkan pipeline…");
  const pipeline = buildPipeline(AppState.parsed.capability);

  try {
    const result = await pipeline.run(prompt, { mode, style, styleLabel, stylePrefix, size, seed }, (label, p) => {
      AppState.loadingBar.setLabel(label);
      if (typeof p === "number") AppState.loadingBar.set(p);
    });

    // Set preview
    AppState.currentBlob = result.blob || null;
    AppState.currentUrl = result.objectUrl || null;
    AppState.lastSourceUrl = result.sourceUrl || result.objectUrl || null;
    renderPreview(AppState.currentUrl);

    lb.finish("Selesai");
    showToast(`Gambar siap (${result.providerId}).`, "success");
  } catch (err) {
    console.error(err);
    lb.fail("Gagal");
    showToast("Terjadi kesalahan saat membuat gambar.", "error");
  } finally {
    // Re-lock after use as required
    lockToolbarButtons();
  }
}

async function onDownloadClick(e) { // onDownloadClick(
  if (!AppState.currentBlob && AppState.lastSourceUrl) {
    // fetch source url to blob
    const lb = AppState.loadingBar;
    lb.start("Menyiapkan unduhan…");
    try {
      const resp = await fetch(AppState.lastSourceUrl, { mode: "cors", cache: "no-store" });
      const blob = await resp.blob();
      AppState.currentBlob = blob;
    } catch (e) {
      showToast("Gagal mengambil data gambar. Coba ulangi.", "error");
      AppState.loadingBar.fail("Gagal");
      lockToolbarButtons();
      return;
    }
    lb.finish("Siap");
  }
  if (!AppState.currentBlob) {
    showToast("Belum ada gambar untuk diunduh.", "info");
    return;
  }

  const name = `ai-image-${Date.now()}.png`;
  try {
    await downloadBlob(AppState.currentBlob, name, "image/png");
    showToast("Unduhan dimulai.", "success");
  } catch (e) {
    showToast("Tidak dapat mengunduh. Tap & tahan gambar untuk menyimpan.", "info"); // Tap & tahan gambar
  } finally {
    lockToolbarButtons();
  }
}

function onSupportClick() { // onSupportClick(
  showToast("Butuh bantuan? Buka menu Bantuan di footer.", "info");
}

/* ---------- UI Helpers ---------- */
function renderSettings(parsed) {
  const styleSel = document.getElementById("styleSelect");
  styleSel.innerHTML = "";
  parsed.ui.styles.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.id;
    opt.textContent = s.label;
    opt.dataset.prefix = s.prefix;
    styleSel.appendChild(opt);
  });
}

function renderPreview(url) {
  const img = document.getElementById("previewImg");
  const empty = document.getElementById("previewEmpty");
  if (url) {
    img.src = url;
    img.style.display = "block";
    empty.style.display = "none";
    // enable preview actions
    const btnCopy = document.getElementById("btn-copyurl");
    const btnRe = document.getElementById("btn-regenerate");
    btnCopy.disabled = false; btnRe.disabled = false;
  } else {
    img.src = "";
    img.style.display = "none";
    empty.style.display = "grid";
    document.getElementById("btn-copyurl").disabled = true;
    document.getElementById("btn-regenerate").disabled = true;
  }
}

/* ---------- Modal/Sheet ---------- */
function showModal(idOrCfg) {
  const id = typeof idOrCfg === "string" ? idOrCfg : idOrCfg?.id;
  if (!id) return;
  const el = document.getElementById(id);
  if (!el) return;
  const focusable = el.querySelector('.modal-panel,[tabindex],button,input,select,textarea,a[href]');
  el.setAttribute("aria-hidden", "false");
  focusable?.focus();
  document.body.style.overflow = "hidden";
}
function closeModal(evOrId) {
  const id = typeof evOrId === "string" ? evOrId : evOrId?.target?.dataset?.close;
  if (!id) return;
  const el = document.getElementById(id);
  if (!el) return;
  el.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}
function showSheet(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.setAttribute("aria-hidden", "false");
  const panel = el.querySelector(".sheet-panel");
  panel?.focus();
  document.body.style.overflow = "hidden";
}
function closeSheet(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}

/* ---------- Theme ---------- */
function applyTheme(theme) {
  document.documentElement.setAttribute("data-theme", theme);
  // Update meta theme-color
  const meta = document.querySelector('meta[name="theme-color"]');
  const color = theme === "light" ? "#ffffff" : "#0b0b0b";
  if (meta) meta.setAttribute("content", color);
}

/* ---------- Init ---------- */
async function initApp({ title, options } = {}) { // initApp(
  window.Telegram?.WebApp?.expand?.(); // window.Telegram?.WebApp?.expand(
  AppState.parsed = parseTitle(title || "AI Maker Teks To Image");
  document.querySelector("h1.title").textContent = AppState.parsed.title;

  // LoadingBar
  AppState.loadingBar = new LoadingBar(document.getElementById("loadingbar"));

  // Render settings
  renderSettings(AppState.parsed);

  // Discover providers
  AppState.loadingBar.start("Memeriksa penyedia…");
  AppState.providersReachable = await discoverProviders({ timeout: 3000 });
  AppState.loadingBar.finish("Siap");

  // Bind toolbar
  document.getElementById("btn-unlock").addEventListener("click", onUnlockClick);
  document.getElementById("btn-generate").addEventListener("click", onGenerateClick);
  document.getElementById("btn-regenerate").addEventListener("click", onGenerateClick);
  document.getElementById("btn-download").addEventListener("click", onDownloadClick);
  document.getElementById("btn-new").addEventListener("click", () => {
    document.getElementById("promptInput").value = "";
    renderPreview(null);
    showToast("Bidang dikosongkan.", "info");
    lockToolbarButtons();
  });
  document.getElementById("btn-import").addEventListener("click", () => showSheet("sheet-import"));
  document.querySelectorAll('[data-close="sheet-import"]').forEach(el => el.addEventListener("click", () => closeSheet("sheet-import")));
  document.getElementById("btn-import-apply").addEventListener("click", async () => {
    const txt = document.getElementById("importText").value.trim();
    const fileEl = document.getElementById("fileInput");
    let content = txt;
    if (!content && fileEl.files?.[0]) {
      content = await fileEl.files[0].text();
    }
    if (!content) { showToast("Tidak ada teks yang diimpor.", "info"); return; }
    document.getElementById("promptInput").value = content.trim();
    closeSheet("sheet-import");
    showToast("Deskripsi berhasil diimpor.", "success");
    lockToolbarButtons();
  });

  // Copy URL
  document.getElementById("btn-copyurl").addEventListener("click", async () => {
    if (!AppState.lastSourceUrl) { showToast("Belum ada URL.", "info"); return; }
    try {
      await navigator.clipboard.writeText(AppState.lastSourceUrl);
      showToast("URL disalin.", "success");
    } catch {
      showToast("Gagal menyalin URL.", "error");
    }
    lockToolbarButtons();
  });

  // Menu + Footer modals
  document.getElementById("btn-menu").addEventListener("click", ()=> showModal("modal-menu"));
  document.querySelectorAll('[data-close="modal-menu"]').forEach(el => el.addEventListener("click", closeModal));
  document.querySelectorAll('[data-open]').forEach(el => {
    el.addEventListener("click", () => {
      const id = el.getAttribute("data-open");
      showModal(id);
    });
  });
  document.querySelectorAll('[data-close="modal-bantuan"],[data-close="modal-panduan"],[data-close="modal-ketentuan"],[data-close="modal-tentang"]').forEach(el => el.addEventListener("click", closeModal));
  document.querySelectorAll('.modal-backdrop').forEach(el => el.addEventListener("click", (ev)=> closeModal(ev)));

  // Theme
  document.getElementById("btn-theme").addEventListener("click", () => {
    const now = document.documentElement.getAttribute("data-theme") || "dark";
    const next = now === "dark" ? "light" : "dark";
    applyTheme(next);
  });

  // Keyboard: ESC closes things
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      ["modal-menu","modal-bantuan","modal-panduan","modal-ketentuan","modal-tentang"].forEach(id => {
        const el = document.getElementById(id);
        if (el?.getAttribute("aria-hidden")==="false") closeModal(id);
      });
      const sheet = document.getElementById("sheet-import");
      if (sheet?.getAttribute("aria-hidden")==="false") closeSheet("sheet-import");
    }
  });

  // Start in dark theme
  applyTheme("dark");
  // Initial state
  lockToolbarButtons();
  renderPreview(null);

  // Preflight runtime hint (non-blocking)
  runPreflightChecks();
}

/* ---------- Runtime preflight (lightweight) ---------- */
function runPreflightChecks() {
  // Ensure Monetag script present
  const hasMonetag = !!document.querySelector('script[src*="libtl.com/sdk.js"][data-sdk="show_9256839"]');
  if (!hasMonetag) {
    console.warn("Monetag tidak terdeteksi.");
  }
  const meta = document.querySelector('meta[name="theme-color"]');
  if (!meta) { console.warn("Meta theme-color tidak ditemukan."); }
}

/* ---------- Start ---------- */
document.addEventListener("DOMContentLoaded", () => {
  initApp({ title: ["AI Maker Teks To Image"] });
});
</script>
  </body>
</html>
