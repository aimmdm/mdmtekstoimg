<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini App TMA Direct Download</title>
<style>
body { display:flex; flex-direction:column; font-family: Inter, system-ui; margin:0; background:#000; color:#fff; }
header, footer { padding:16px; background:#111; }
main { flex:1; padding:16px; display:flex; flex-direction:column; gap:12px; }
textarea { width:100%; height:100px; padding:8px; border-radius:12px; border:none; resize:none; }
button { padding:12px; border-radius:12px; border:none; font-weight:500; cursor:pointer; background:#fff; color:#000; }
#preview { background:#222; padding:8px; border-radius:8px; min-height:50px; white-space:pre-wrap; }
.toast { position:fixed; bottom:16px; left:50%; transform:translateX(-50%); padding:8px 16px; border-radius:12px; z-index:999; color:#fff; }
.toast.info{ background:#0c0; }
.toast.error{ background:#c00; }
</style>
</head>
<body>
<header>
<h1>Demo SPA TMA Direct</h1>
<button id="theme-toggle">Tema</button>
</header>

<main>
<textarea id="input-text" placeholder="Ketik teks..."></textarea>
<button id="generate-btn">Buat File</button>
<pre id="preview"></pre>
</main>

<footer>
<p>Demo Footer</p>
</footer>

<script>
const IS_TMA = !!window.Telegram?.WebApp;

// Toast TMA-safe
function showToast(msg,type="info"){
  const toast=document.createElement("div");
  toast.className="toast "+type;
  toast.textContent=msg;
  document.body.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

// Kirim file ke bot
async function sendFileToBot(blob, filename){
  const reader=new FileReader();
  reader.onload=()=>{
    const base64=reader.result.split(",")[1];
    if(IS_TMA){
      Telegram.WebApp.sendData(JSON.stringify({
        type:"file",
        filename,
        content: base64
      }));
      showToast("File dikirim ke bot. Cek chat untuk download.");
    } else {
      showToast("Demo hanya TMA-safe.");
    }
  };
  reader.readAsDataURL(blob);
}

// Event Generate
document.getElementById("generate-btn").addEventListener("click", ()=>{
  const text=document.getElementById("input-text").value||"Demo Teks";
  const blob=new Blob([text], {type:"text/plain"});
  document.getElementById("preview").textContent=text;
  sendFileToBot(blob,"hasil.txt");
});

// Theme toggle
document.getElementById("theme-toggle").addEventListener("click", ()=>{
  if(document.body.style.background=="#000"){
    document.body.style.background="#fff";
    document.body.style.color="#000";
  } else {
    document.body.style.background="#000";
    document.body.style.color="#fff";
  }
});
</script>
</body>
</html>
