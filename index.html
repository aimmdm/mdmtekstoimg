<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini App TMA Demo</title>
  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9256839' data-sdk='show_9256839'></script>
  <style>
    body { display:flex; flex-direction:column; font-family: Inter, system-ui; margin:0; background:#000; color:#fff; }
[data-sticky="header"], [data-sticky="footer"] { padding:16px; background:#111; }
#app-container { flex:1; padding:16px; display:flex; flex-direction:column; gap:12px; }
textarea { width:100%; height:100px; padding:8px; border-radius:12px; border:none; resize:none; }
button { padding:12px; border-radius:12px; border:none; font-weight:500; cursor:pointer; background:#fff; color:#000; }
button:disabled { opacity:0.5; cursor:not-allowed; }
  </style>
</head>
<body>
  <header data-sticky="header">
    <h1>Demo SPA TMA</h1>
    <button id="theme-toggle">Tema</button>
  </header>

  <main id="app-container">
    <textarea id="input-text" placeholder="Ketik teks di sini..."></textarea>
    <button id="generate-btn">Generate File</button>
    <button id="unlock-btn">Buka Fitur (Tonton Iklan)</button>
  </main>

  <footer data-sticky="footer">
    <p>Demo Footer</p>
  </footer>

  <script>
    /* PREFLIGHT_OK: TMA_SAFE */

const IS_TMA = !!window.Telegram?.WebApp;

function showToast(msg) {
  alert(msg); // minimal demo, bisa diganti toast UI
}

async function sendFileToBot(blob, filename) {
  const reader = new FileReader();
  reader.onload = () => {
    const base64 = reader.result.split(",")[1];
    Telegram.WebApp.sendData(JSON.stringify({
      type:"file",
      filename,
      content: base64
    }));
    showToast("File dikirim ke bot. Cek chat untuk download.");
  };
  reader.readAsDataURL(blob);
}

document.getElementById("generate-btn").addEventListener("click", () => {
  const text = document.getElementById("input-text").value || "Demo Teks";
  const blob = new Blob([text], {type:"text/plain"});
  sendFileToBot(blob, "hasil.txt");
});

document.getElementById("unlock-btn").addEventListener("click", async () => {
  try {
    await withMonetagInApp("Buka Fitur", () => showToast("Fitur unlocked!"));
  } catch(e) {
    showToast("Gagal memuat iklan, coba lagi.");
  }
});

  </script>
</body>
</html>
